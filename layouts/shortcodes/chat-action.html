{{ $type := .Get "type" | default "action" }}
{{ $from := .Get "from" }}
{{ $time := .Get "time" }}
{{ $colorKey := substr (md5 $from) 0 1 }}
{{ $colors := dict 
  "0" "#ef5350" "1" "#ec407a" "2" "#ab47bc" "3" "#7e57c2" 
  "4" "#5c6bc0" "5" "#42a5f5" "6" "#29b6f6" "7" "#26c6da" 
  "8" "#26a69a" "9" "#66bb6a" "a" "#9ccc65" "b" "#d4e157" 
  "c" "#ffee58" "d" "#ffca28" "e" "#ffa726" "f" "#ff7043" 
}}
{{ $userColor := index $colors $colorKey }}
<div class="chat-line" style="display: flex; flex-direction: row; align-items: baseline; margin-bottom: 2px; width: 100%;">
  {{ if $time }}<span class="chat-timestamp" style="color: #777; margin-right: 8px; user-select: none; font-size: 0.85em; flex-shrink: 0; white-space: nowrap;">[{{ $time }}]</span>{{ end }}
  {{ if eq $type "join" }}
    <span class="chat-join" style="color: #4caf50; font-style: italic; flex-grow: 1;">*** <span class="chat-user chat-color-{{ $colorKey }}" style="font-weight: bold; flex-shrink: 0; white-space: nowrap; color: {{ $userColor }};">{{ $from }}</span> has joined</span>
  {{ else if eq $type "leave" }}
    <span class="chat-leave" style="color: #ff5722; font-style: italic; flex-grow: 1;">*** <span class="chat-user chat-color-{{ $colorKey }}" style="font-weight: bold; flex-shrink: 0; white-space: nowrap; color: {{ $userColor }};">{{ $from }}</span> has left</span>
  {{ else }}
    <span class="chat-action" style="color: #e040fb; font-style: italic; flex-grow: 1;">* <span class="chat-user chat-color-{{ $colorKey }}" style="font-weight: bold; flex-shrink: 0; white-space: nowrap; color: {{ $userColor }};">{{ $from }}</span> {{ .Inner | markdownify }}</span>
  {{ end }}
</div>
